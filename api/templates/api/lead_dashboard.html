<!DOCTYPE html>
<html>
<head>
    <title>Lead Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f0f2f5;
        }
        .table-container {
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        th {
            background-color: #007bff;
            color: black;
            cursor: pointer;
        }
        @media (max-width: 768px) { /* Tablet & Mobile View */
            th, td {
                font-size: 0.9rem;
            }
        }
        @media (max-width: 576px) { /* Mobile View */
            .table-responsive {
                border: none;
            }
            th, td {
                padding: 0.3rem;
                white-space: nowrap;
            }
            .filter-form {
                flex-direction: column;
            }
            .filter-form div {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-5 mb-5">
        <h1 class="text-center mb-4">Lead Dashboard</h1>

        <!-- Search & Filter Form -->
        <form method="GET" class="mb-4 d-flex justify-content-between flex-wrap filter-form">
            <div>
                <input type="text" name="search" value="{{ search_query }}" placeholder="Search by Name" class="form-control">
            </div>
            <div>
                <select name="status" class="form-select">
                    <option value="All">All Status</option>
                    <option value="Unique Lead" {% if selected_status == 'Unique Lead' %}selected{% endif %}>Unique Lead</option>
                    <option value="Repeat Lead" {% if selected_status == 'Repeat Lead' %}selected{% endif %}>Repeat Lead</option>
                </select>
            </div>
            <div>
                <select name="source" class="form-select">
                    <option value="All">All Sources</option>
                    <option value="google" {% if selected_source == 'google' %}selected{% endif %}>Google</option>
                    <option value="facebook" {% if selected_source == 'facebook' %}selected{% endif %}>Facebook</option>
                    <option value="other" {% if selected_source == 'other' %}selected{% endif %}>Other</option>
                </select>
            </div>
            <div>
                <select name="medium" class="form-select">
                    <option value="All">All Mediums</option>
                    <option value="organic" {% if selected_medium == 'organic' %}selected{% endif %}>Organic</option>
                    <option value="paid" {% if selected_medium == 'paid' %}selected{% endif %}>Paid</option>
                    <option value="referral" {% if selected_medium == 'referral' %}selected{% endif %}>Referral</option>
                </select>
            </div>
            <div>
                <button type="submit" class="btn btn-primary">Apply Filters</button>
            </div>
        </form>

        <!-- Leads Table (Responsive) -->
        <div class="table-responsive table-container shadow-sm">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">Name</th>
                        <th onclick="sortTable(1)">Email</th>
                        <th onclick="sortTable(2)">Phone</th>
                        <th onclick="sortTable(3)">Status</th>
                        <th onclick="sortTable(4)">Source</th>
                        <th onclick="sortTable(5)">Medium</th>
                        <th onclick="sortTable(6)">Created At</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lead in leads %}
                    <tr>
                        <td>{{ lead.name }}</td>
                        <td>{{ lead.email }}</td>
                        <td>{{ lead.phone }}</td>
                        <td>{{ lead.status }}</td>
                        <td>{{ lead.source }}</td>
                        <td>{{ lead.medium }}</td>
                        <td>{{ lead.created_at }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- JavaScript for Sorting -->
    <script>
        function sortTable(columnIndex) {
            var table = document.querySelector("table tbody");
            var rows = Array.from(table.rows);
            var sortedRows = rows.sort(function(a, b) {
                var aText = a.cells[columnIndex].innerText.trim().toLowerCase();
                var bText = b.cells[columnIndex].innerText.trim().toLowerCase();
                return aText.localeCompare(bText);
            });

            table.innerHTML = "";
            sortedRows.forEach(row => table.appendChild(row));
        }
    </script>
</body>
</html>
